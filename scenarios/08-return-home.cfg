#textdomain wesnoth-drusi

#define RETURN_HOME_SCENARIO ID ENEMY
[scenario]
	id={ID}
	# Note: This key is not actually used, since [endlevel] sets the
	# next scenario; therefore I've put the test scenario here so that
	# it shows up in the choose_level list.
	next_scenario=test-druid-siege

	name=The Journey Home
	map_data="{~add-ons/DruidSiege/maps/return-home.map}"
	victory_when_enemies_defeated=no
	turns=40
	{EXPERIENCE_MOD}
	{DEFAULT_SCHEDULE}
	[music]
		name=travelling_minstrels.ogg
        ms_before=12000
    [/music]
    [music]
    	name=wanderer.ogg
        ms_before=12000
    	append=yes
    [/music]
    victory_music=elf-land.ogg
    #wmllint: validate-off
	[side]
		side=1
		{HERO_SIDE} #wmllint: recognize chiefdruid
		recruit=Elvish Initiate,Elvish Civilian
		gold=200
		income=3
		fog=no
		shroud=no
	[/side]
	#wmllint: validate-on
	{ENEMY} #wmllint: skip-side
	[side]
		side=3
		controller=ai
		no_leader=yes
		color=green
		current_player=_"Monsters"
		team_name=monsters
		user_team_name=_"Monsters"
		{FLAG_VARIANT long}
		{GENERIC_UNIT 3 (Giant Scorpion) 7 17}
		{GENERIC_UNIT 3 (Giant Scorpion) 18 16}
		{GENERIC_UNIT 3 (Giant Scorpion) 10 35}{GUARDIAN}
		{GENERIC_UNIT 3 (Giant Scorpion) 10 47}{GUARDIAN}
		{GENERIC_UNIT 3 (Great Wolf) 13 52}{GUARDIAN}
		{GENERIC_UNIT 3 Wolf 13 53}{GUARDIAN}
		{GENERIC_UNIT 3 Wolf 13 51}{GUARDIAN}
		{GENERIC_UNIT 3 Wolf 12 51}{GUARDIAN}
		{GENERIC_UNIT 3 Wolf 14 51}{GUARDIAN}
		{GENERIC_UNIT 3 Wolf 12 52}{GUARDIAN}
		{GENERIC_UNIT 3 Wolf 14 52}{GUARDIAN}
		{GENERIC_UNIT 3 (Giant Toad) 9 60}{GUARDIAN}
		{GENERIC_UNIT 3 (Giant Toad) 10 58}{GUARDIAN}
		[ai]
			village_value=0
		[/ai]
	[/side]
	[side]
		side=4
		controller=ai
		color=brown
		no_leader=yes
		current_player=_"Ogre"
		team_name=monsters
		user_team_name=_"Monsters"
		fog=yes
		{FLAG_VARIANT long}
		{GENERIC_UNIT 3 Ogre 3 34}{GUARDIAN}
		{GENERIC_UNIT 3 (Young Ogre) 3 35}{GUARDIAN}
	[/side]
	[story]
		[part]
			show_title=yes
			story=_"Having dispatched the lich, the elves hurried home by the most direct path possible."
			background=aleron-map.png
		[/part]
		[part]
			background=aleron-map.png
			{OLD_BATTLE 380 574}
			{OLD_JOURNEY 393 542}
			{OLD_JOURNEY 407 523}
			{OLD_JOURNEY 422 500}
			{OLD_JOURNEY 437 480}
			{OLD_JOURNEY 457 463}
			{OLD_JOURNEY 476 446}
			{OLD_BATTLE 499 421}
			{OLD_JOURNEY 517 409}
			{OLD_JOURNEY 533 396}
			{OLD_JOURNEY 554 383}
			{OLD_JOURNEY 556 404}
			{OLD_JOURNEY 571 420}
			{OLD_REST 595 417}
			{OLD_JOURNEY 614 408}
			{OLD_JOURNEY 636 392}
			{OLD_JOURNEY 657 377}
			{OLD_JOURNEY 678 365}
			{OLD_BATTLE 694 352}
			{OLD_JOURNEY 674 349}
			{OLD_JOURNEY 650 353}
			{OLD_JOURNEY 628 366}
			{OLD_JOURNEY 596 369}
			{OLD_BATTLE 594 346}
			{OLD_JOURNEY 610 355}
			{OLD_JOURNEY 629 347}
			{OLD_JOURNEY 627 321}
			{OLD_JOURNEY 621 292}
			{OLD_JOURNEY 614 267}
			{OLD_JOURNEY 603 242}
			{OLD_JOURNEY 590 222}
			{OLD_JOURNEY 568 209}
			{OLD_JOURNEY 544 194}
			{OLD_REST 543 179}
			{OLD_JOURNEY 515 181}
			{OLD_JOURNEY 492 177}
			{OLD_JOURNEY 464 173}
			{OLD_BATTLE 438 161}
			{OLD_JOURNEY 413 171}
			{OLD_JOURNEY 388 182}
			{OLD_JOURNEY 370 197}
			{OLD_JOURNEY 350 214}
			{OLD_JOURNEY 331 228}
			{OLD_BATTLE 311 233}
			{OLD_BATTLE 283 217}
			{NEW_JOURNEY 280 233}
			{NEW_JOURNEY 292 250}
			{NEW_JOURNEY 316 264}
			{NEW_JOURNEY 337 276}
			{NEW_BATTLE 359 295}
		[/part]
	[/story]
#ifdef DRUID_DEBUG
	{FORCE_CHANCE_TO_HIT side=2,3 side=1 10 ()}
	{FORCE_CHANCE_TO_HIT side=1 side=2,3 90 ()}
#endif
	{LIMITED_ELF_RECRUITS}
	{SHAMAN_ADVANCEMENT_EVENTS}
	{PRELOAD_EVENT}
	{ENABLE_TROLL_SHAMAN}
	{HERO_DEATHS}
	
	[event]
		name=prestart
		[recall]
			id=chiefguard
		[/recall]
		[recall]
			id=agedlord
		[/recall]
		[recall]
			id=agedcaptain
		[/recall]
		[recall]
			id=hermitsorceress
		[/recall]
		[objectives]
			[objective]
				description=_"Reach the river and cross it"
				condition=win
			[/objective]
			[objective]
				description=_"Death of EÃ¤rendil"
				condition=lose
			[/objective]
			[objective]
				description=_"Death of Erendor"
				condition=lose
			[/objective]
			[objective]
				description=_"Death of Hallen"
				condition=lose
			[/objective]
			{TURNS_RUN_OUT}
			[note]
				description=_"The scenario ends when any of your units reaches the bridge."
			[/note]
		[/objectives]
		{PLACE_IMAGE "scenery/leanto.png" 3 35}
	[/event]
	
	[event]
		name=moveto
		[filter]
			side=1
			[filter_location]
				terrain=W*^B*
			[/filter_location]
		[/filter]
		[if]
			[variable]
				name=killed_malcorn
				boolean_equals=yes
			[/variable]
			[then]
				[endlevel]
					result=victory
					next_scenario=back-home-goblins
				[/endlevel]
			[/then]
			[else]
				[endlevel]
					result=victory
					next_scenario=back-home-malcorn
				[/endlevel]
			[/else]
		[/if]
	[/event]
	
	{STARTING_VILLAGES_ALL 2}
	
	{ON_SIGHTING ogre 4 side=1 (
		[message]
			speaker=unit
			message=_"$unit.name eat puny $second_unit.race!"
		[/message]
		[message]
			speaker=second_unit
			message=_"I think that is a bad idea. I'm very stringy."
		[/message]
		[message]
			speaker=unit
			message=_"$unit.name not care! $unit.name has eaten only bugs for past six days!"
		[/message]
	)}
[/scenario]
#enddef

#define LOYAL_OUTLAW TYPE GENDER
	[unit]
		type={TYPE}
		placement=leader
		gender=gender
		{IS_LOYAL}
		[modifications]
			{TRAIT_LOYAL}
		[/modifications]
	[/unit]
#enddef

{RETURN_HOME_SCENARIO return-home (
	[side]
		side=2
		controller=ai
		recruit=Thug,Bandit,Ruffian,Footpad,Outlaw,Woodsman,Poacher,Trapper,Fencer,Mage,Duelist,Red Mage,White Mage,Huntsman,Ranger
		gold=200
		income=1
		color=red
		current_player=_"Harry Muflin"
		team_name=monsters
		user_team_name=_"Harry Muflin"
			id=outlaw
			type=Fugitive
			name=_"Harry Muflin"
			gender=male
			[modifications]
				{TRAIT_SPEEDY}
				{TRAIT_AGILE}
				{TRAIT_MIGHTY}
			[/modifications]
		{LOYAL_OUTLAW (Silver Mage) male}
		{LOYAL_OUTLAW Highwayman male}
		{LOYAL_OUTLAW (White Mage) female}
		{LOYAL_OUTLAW Assassin female}
		{LOYAL_OUTLAW Assassin male}
	[/side]
	[event]
		name=start
		[message]
			speaker=outlaw
			message=_"Oho, what have we here? A band of elves returning home! Let us see how much loot we can get from them!"
		[/message]
	[/event]
)}

{RETURN_HOME_SCENARIO harried-return (
	[side]
		side=2
		{ORC_SIDE}
		recruit=Goblin Impaler,Goblin Rouser,Orcish Crossbowman,Orcish Slayer,Orcish Warrior,Goblin Knight,Goblin Pillager,Goblin Spearman,Wolf Rider,Orcish Archer,Orcish Assassin,Orcish Grunt
		gold=250
		income=2
		user_team_name=_"Orcs"
		team_name=orcs,monsters
	[/side]
	{RESTORE_AI_SIDE 2 orcs 9,27}
	[event]
		name=start
		[if]
			[variable]
				name=killedgragchak
				boolean_equals=yes
			[/variable]
			[then]
				[recall]
					id=sonofgragchak
					x,y=8,27
					show=no
				[/recall]
				[kill]
					id=gragchak
				[/kill]
				[modify_side]
					side=2
					controller=ai # Not sure why this is needed
					recruit=Goblin Spearman,Wolf Rider,Orcish Archer,Orcish Assassin,Orcish Grunt,Troll Whelp
					gold=200
					income=1
				[/modify_side]
				[message]
					speaker=sonofgragchak
					message=_"First you kill my father, then you get in the way of my vengeance! Now it is time for you to die!"
				[/message]
			[/then]
			[else]
				[message]
					speaker=gragchak
					message=_"You killed Kaden Kreuz, who was mine to kill. In exchange for this insult, I will take your life."
				[/message]
			[/else]
		[/if]
	[/event]
)}

#undef RETURN_HOME_SCENARIO
#undef LOYAL_OUTLAW